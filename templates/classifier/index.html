<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificador de Email</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 700px;
        }
        .card {
            border-radius: 0.75rem;
        }
        #result-card {
            display: none;
        }
        .confidence-badge {
            font-size: 0.9rem;
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h1 class="card-title text-center mb-4">Analisador de Emails com IA</h1>
                <form id="classifier-form">
                    <div class="mb-3">
                        <label for="email-text" class="form-label">Cole o texto do email abaixo:</label>
                        <textarea class="form-control" id="email-text" rows="8" placeholder="Cole o conteúdo do seu email aqui..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="email-file" class="form-label">Ou faça o upload de um arquivo:</label>
                        <input class="form-control" type="file" id="email-file" accept=".txt,.pdf,.doc,.docx">
                        <div class="form-text">Formatos aceitos: .txt, .pdf, .doc, .docx</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            Analisar Email
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card shadow-sm mt-4" id="result-card">
            <div class="card-body">
                <h2 class="card-title">Resultado da Análise</h2>
                <div id="results">
                    <p>
                        <strong>Categoria:</strong> 
                        <span id="result-category" class="badge bg-primary"></span>
                        <span id="result-confidence" class="badge bg-secondary confidence-badge ms-2"></span>
                    </p>
                    <p><strong>Resposta Sugerida:</strong></p>
                    <div id="result-suggestion" class="p-3 bg-light border rounded"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('classifier-form');
        const submitBtn = document.getElementById('submit-btn');
        const emailText = document.getElementById('email-text');
        const emailFile = document.getElementById('email-file');
        const resultCard = document.getElementById('result-card');
        const resultCategory = document.getElementById('result-category');
        const resultConfidence = document.getElementById('result-confidence');
        const resultSuggestion = document.getElementById('result-suggestion');

        function setLoading(isLoading) {
            submitBtn.disabled = isLoading;
            if (isLoading) {
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Analisando...';
            } else {
                submitBtn.textContent = 'Analisar Email';
            }
        }

        function showError(message) {
            resultCategory.textContent = 'Erro';
            resultCategory.className = 'badge bg-danger';
            resultConfidence.textContent = '';
            resultSuggestion.textContent = message;
            resultCard.style.display = 'block';
        }

        function showResult(data) {
            resultCategory.textContent = data.classification;
            resultCategory.className = data.classification === 'Produtivo' 
                ? 'badge bg-success' 
                : 'badge bg-warning';
            
            if (data.confidence) {
                resultConfidence.textContent = `${data.confidence}% de confiança`;
            }
            
            resultSuggestion.textContent = data.suggested_response;
            resultCard.style.display = 'block';
        }

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            setLoading(true);

            try {
                let response;
                
                // Verifica se um arquivo foi selecionado
                if (emailFile.files.length > 0) {
                    const formData = new FormData();
                    formData.append('file', emailFile.files[0]);
                    
                    response = await fetch('', {
                        method: 'POST',
                        body: formData
                    });
                } 
                // Caso contrário, envia o texto
                else {
                    const textContent = emailText.value.trim();
                    
                    if (!textContent) {
                        showError('Por favor, forneça um texto ou selecione um arquivo.');
                        setLoading(false);
                        return;
                    }
                    
                    response = await fetch('', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email_text: textContent })
                    });
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                showResult(data);

            } catch (error) {
                console.error('Erro ao classificar o email:', error);
                showError(error.message || 'Ocorreu um erro ao processar a solicitação.');
            } finally {
                setLoading(false);
            }
        });

        // Limpa o outro campo quando um é usado
        emailText.addEventListener('input', function() {
            if (this.value.trim()) {
                emailFile.value = '';
            }
        });

        emailFile.addEventListener('change', function() {
            if (this.files.length > 0) {
                emailText.value = '';
            }
        });
    </script>
</body>
</html>